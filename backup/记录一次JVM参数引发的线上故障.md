我们都知道，-Xms, -Xmx是控制JVM的参数，**如果堆内存设置的比服务器的实际内存更大，那么服务还可以正常启动吗**？答案其实是可以。

_环境：JDK8u141，使用CMS垃圾回收器。（**不要问为什么不用新的**）_

# 故障出现

最近线上出现了这样一个故障，由于业务前线没有通知到我们，所以服务流量上涨了很多。这个时候我突然发现，内存在不断上涨，从67%一路上升，一直到85%，已经触发了我们的警报。


# 初步解决
我们认为直接扩容可能就没问题了，所以扩充了三倍的容器数量，这个时候明显感觉到服务器已经下降了。

让我们看下最高的那条红色的线，可以观察但是内存占用依然在不断上升，甚至没有下降的趋势，并且95%的内存占用一直持续了8个小时。在这个时候我们觉得内存有**内存泄漏**，正常的JVM都应当是占用内存空间有一个波动，有时高有时低才对，至少也应该在过了一夜之后下降。但是“**JVM经过内存回收会使机器的内存占用量下降**”这样的观念值得起推敲吗？

![image](https://github.com/user-attachments/assets/48c0cadb-3bf9-42c3-b16d-b09b9783df91)

# 发现疑问

GC日志给出了JVM里面所有对象的信息。可以发现，其实对象是经常变化的，FULL GC之后，对象是经历正常回收的。我们都知道内存泄漏就是某些对象超出了被正常回收的范围。在这里看起来显然不是。

![image](https://github.com/user-attachments/assets/6a16a642-ec6e-4852-bf4a-5ddf75ed530b)


这个时候我突然发现，JVM参数是-Xms=4g, -Xmx=8g。而我们的服务器内存总共才有2g。这时可以明显看出有问题了，但是，**问题在哪**？


# 深入探明真相
## 超内存提交
第一个自然而然的疑问，当然是，看起来需要的空间比拥有的多，为什么服务可以正常启动？


待更新(遗留问题)
1、为什么支持超内存提交？怎么查看？
2、为什么虚拟内存VSZ占用比较高，有19G？
3、为什么JVM初始创建时，没有达到Xms预期的实际占用内存量(4G)？